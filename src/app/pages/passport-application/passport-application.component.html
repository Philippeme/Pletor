<div class="passport-application-page">
    <div class="container py-4">

        <!-- Page Header -->
        <div class="page-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="page-title">
                        <i class="fas fa-passport me-3"></i>
                        Passport Application
                    </h1>
                    <p class="text-muted">Apply for a Bissau-Guinean passport online</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="tracking-info" *ngIf="application">
                        <strong>Tracking #:</strong> {{ application.trackingNumber }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-container mb-5">
            <div class="progress-steps">
                <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
                    <div class="step-circle">1</div>
                    <span class="step-label">Personal Info</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 1"></div>
                <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
                    <div class="step-circle">2</div>
                    <span class="step-label">Contact Details</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 2"></div>
                <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
                    <div class="step-circle">3</div>
                    <span class="step-label">Documents</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 3"></div>
                <div class="step" [class.active]="currentStep >= 4" [class.completed]="currentStep > 4">
                    <div class="step-circle">4</div>
                    <span class="step-label">Payment</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 4"></div>
                
                <div class="step" [class.active]="currentStep >= 5" [class.completed]="currentStep > 5">
                    <div class="step-circle">5</div>
                    <span class="step-label">Biometric Confirmation</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 6"></div>
                <div class="step" [class.active]="currentStep >= 6" [class.completed]="currentStep > 6">
                    <div class="step-circle">6</div>
                    <span class="step-label">Passport Collection</span>
                </div>
            </div>
        </div>

        <!-- Application Form -->
        <div class="application-form">

            <!-- Error/Success Messages -->
            <div class="alert alert-danger" *ngIf="errorMessage" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                {{ errorMessage }}
            </div>

            <div class="alert alert-success" *ngIf="successMessage" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                {{ successMessage }}
            </div>

            <form [formGroup]="passportForm">

                <!-- Step 1: Personal Information -->
                <div class="form-step" *ngIf="currentStep === 1">
                    <div class="step-header mb-4">
                        <h3>Personal Information</h3>
                        <p class="text-muted">Please provide your personal details as they appear on your birth
                            certificate</p>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">First Name *</label>
                            <input type="text" class="form-control" formControlName="firstName"
                                [class.is-invalid]="passportForm.get('firstName')?.invalid && passportForm.get('firstName')?.touched">
                            <div class="invalid-feedback">First name is required</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Middle Name</label>
                            <input type="text" class="form-control" formControlName="middleName">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Last Name *</label>
                            <input type="text" class="form-control" formControlName="lastName"
                                [class.is-invalid]="passportForm.get('lastName')?.invalid && passportForm.get('lastName')?.touched">
                            <div class="invalid-feedback">Last name is required</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" class="form-control" formControlName="dateOfBirth"
                                [class.is-invalid]="passportForm.get('dateOfBirth')?.invalid && passportForm.get('dateOfBirth')?.touched">
                            <div class="invalid-feedback">Date of birth is required</div>
                            <small class="form-text text-muted" *ngIf="passportForm.get('dateOfBirth')?.value">
                                Age: {{ calculateAge(passportForm.get('dateOfBirth')?.value) }} years
                            </small>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Place of Birth *</label>
                            <input type="text" class="form-control" formControlName="placeOfBirth"
                                [class.is-invalid]="passportForm.get('placeOfBirth')?.invalid && passportForm.get('placeOfBirth')?.touched">
                            <div class="invalid-feedback">Place of birth is required</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Nationality *</label>
                            <input type="text" class="form-control" formControlName="nationality" readonly>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Gender *</label>
                            <select class="form-select" formControlName="gender"
                                [class.is-invalid]="passportForm.get('gender')?.invalid && passportForm.get('gender')?.touched">
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                            <div class="invalid-feedback">Gender is required</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Marital Status *</label>
                            <select class="form-select" formControlName="maritalStatus"
                                [class.is-invalid]="passportForm.get('maritalStatus')?.invalid && passportForm.get('maritalStatus')?.touched">
                                <option value="">Select Marital Status</option>
                                <option value="Single">Single</option>
                                <option value="Married">Married</option>
                                <option value="Divorced">Divorced</option>
                                <option value="Widowed">Widowed</option>
                            </select>
                            <div class="invalid-feedback">Marital status is required</div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Contact Information -->
                <div class="form-step" *ngIf="currentStep === 2">
                    <div class="step-header mb-4">
                        <h3>Contact & Emergency Information</h3>
                        <p class="text-muted">Provide your current contact details and emergency contact</p>
                    </div>

                    <!-- Contact Information -->
                    <h5 class="mb-3">Contact Information</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Phone Number *</label>
                            <input type="tel" class="form-control" formControlName="phoneNumber"
                                [class.is-invalid]="passportForm.get('phoneNumber')?.invalid && passportForm.get('phoneNumber')?.touched">
                            <div class="invalid-feedback">Phone number is required</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email Address *</label>
                            <input type="email" class="form-control" formControlName="email"
                                [class.is-invalid]="passportForm.get('email')?.invalid && passportForm.get('email')?.touched">
                            <div class="invalid-feedback">Valid email is required</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Current Address *</label>
                            <textarea class="form-control" rows="3" formControlName="currentAddress"
                                [class.is-invalid]="passportForm.get('currentAddress')?.invalid && passportForm.get('currentAddress')?.touched"></textarea>
                            <div class="invalid-feedback">Current address is required</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Permanent Address *</label>
                            <textarea class="form-control" rows="3" formControlName="permanentAddress"
                                [class.is-invalid]="passportForm.get('permanentAddress')?.invalid && passportForm.get('permanentAddress')?.touched"></textarea>
                            <div class="invalid-feedback">Permanent address is required</div>
                        </div>
                    </div>

                    <!-- Emergency Contact -->
                    <h5 class="mb-3 mt-4">Emergency Contact</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Full Name *</label>
                            <input type="text" class="form-control" formControlName="emergencyContactName"
                                [class.is-invalid]="passportForm.get('emergencyContactName')?.invalid && passportForm.get('emergencyContactName')?.touched">
                            <div class="invalid-feedback">Emergency contact name is required</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Phone Number *</label>
                            <input type="tel" class="form-control" formControlName="emergencyContactPhone"
                                [class.is-invalid]="passportForm.get('emergencyContactPhone')?.invalid && passportForm.get('emergencyContactPhone')?.touched">
                            <div class="invalid-feedback">Emergency contact phone is required</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Relationship *</label>
                            <select class="form-select" formControlName="emergencyContactRelation"
                                [class.is-invalid]="passportForm.get('emergencyContactRelation')?.invalid && passportForm.get('emergencyContactRelation')?.touched">
                                <option value="">Select Relationship</option>
                                <option value="Parent">Parent</option>
                                <option value="Spouse">Spouse</option>
                                <option value="Sibling">Sibling</option>
                                <option value="Child">Child</option>
                                <option value="Friend">Friend</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="invalid-feedback">Relationship is required</div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Document Upload -->
                <div class="form-step" *ngIf="currentStep === 3">
                    <div class="step-header mb-4">
                        <h3>Required Documents</h3>
                        <p class="text-muted">Upload all required documents. Files must be in PDF, JPEG, or PNG format
                            (max 5MB each)</p>
                    </div>

                    <div class="documents-grid">
                        <div class="document-item" *ngFor="let doc of requiredDocuments">
                            <div class="document-header">
                                <h6 class="document-name">
                                    {{ doc.name }}
                                    <span class="badge bg-danger ms-2" *ngIf="doc.required">Required</span>
                                    <span class="badge bg-secondary ms-2" *ngIf="!doc.required">Optional</span>
                                </h6>
                            </div>

                            <div class="document-upload" *ngIf="!uploadedFiles[doc.id]">
                                <input type="file" [id]="'file-' + doc.id" (change)="onFileUpload($event, doc.id)"
                                    accept=".pdf,.jpg,.jpeg,.png" class="d-none">
                                <label [for]="'file-' + doc.id" class="upload-label">
                                    <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                    <span>Click to upload or drag and drop</span>
                                    <small class="text-muted d-block">PDF, JPEG, PNG (max 5MB)</small>
                                </label>
                            </div>

                            <div class="document-uploaded" *ngIf="uploadedFiles[doc.id]">
                                <div class="uploaded-file">
                                    <div class="file-info">
                                        <i class="fas fa-file-alt fa-2x text-success me-3"></i>
                                        <div>
                                            <strong>{{ uploadedFiles[doc.id].name }}</strong>
                                            <small class="text-muted d-block">{{ (uploadedFiles[doc.id].size /
                                                1024).toFixed(1) }} KB</small>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-outline-danger btn-sm"
                                        (click)="removeFile(doc.id)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Payment -->
                <div class="form-step" *ngIf="currentStep === 4">
                    <div class="step-header mb-4">
                        <h3>Payment</h3>
                        <p class="text-muted">Complete your payment to process your passport application</p>
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="payment-summary mb-4">
                                <h5>Payment Summary</h5>
                                <div class="fee-item">
                                    <div class="d-flex justify-content-between">
                                        <span>Passport Application Fee</span>
                                        <strong>110,000 XAF</strong>
                                    </div>
                                </div>
                                <hr>
                                <div class="total-amount">
                                    <div class="d-flex justify-content-between">
                                        <strong>Total Amount</strong>
                                        <strong class="text-primary">110,000 XAF</strong>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Methods with Accordions -->
                            <div class="payment-methods">
                                <h5 class="mb-3">Select Payment Method</h5>
                                
                                <ngb-accordion #paymentAccordion="ngbAccordion" class="payment-accordion">
                                    <!-- MTN Mobile Money -->
                                    <ngb-accordion-item id="mtn-panel" class="payment-method-item">
                                        <div ngbAccordionButton (click)="selectPaymentMethod('MTN_MONEY')">
                                            <div class="payment-method-header">
                                                <i class="fas fa-mobile-alt text-primary me-3"></i>
                                                <div>
                                                    <strong>MTN Mobile Money</strong>
                                                    <br><small class="text-muted">Pay with your MTN MoMo account</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div ngbAccordionBody>
                                            <ng-template ngbAccordionContent>
                                                <div class="accordion-body">
                                                    <div class="payment-form" *ngIf="selectedPaymentMethod === 'MTN_MONEY'">
                                                        <div class="mb-3">
                                                            <label class="form-label">MTN Phone Number *</label>
                                                            <input type="tel" class="form-control" 
                                                                   [(ngModel)]="mtnPaymentData.phoneNumber"
                                                                   [ngModelOptions]="{standalone: true}"
                                                                   placeholder="6xxxxxxxx" maxlength="9">
                                                            <small class="form-text text-muted">Enter your MTN number without country code</small>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <label class="form-label">Merchant Code</label>
                                                            <input type="text" class="form-control" 
                                                                   value="MKGOV001" readonly>
                                                            <small class="form-text text-muted">MK Gov official merchant code</small>
                                                        </div>

                                                        <!-- Payment Process Steps -->
                                                        <div class="payment-process mb-4" *ngIf="showMtnProcess">
                                                            <h6 class="mb-3">Payment Process:</h6>
                                                            <div class="process-step" 
                                                                 [class.completed]="mtnStep >= 1" 
                                                                 [class.active]="mtnStep === 1">
                                                                <div class="step-number">1</div>
                                                                <div class="step-content">
                                                                    <strong>Dial *126# on your MTN phone</strong>
                                                                    <small class="d-block text-muted">Access MTN Mobile Money menu</small>
                                                                </div>
                                                            </div>
                                                            <div class="process-step" 
                                                                 [class.completed]="mtnStep >= 2" 
                                                                 [class.active]="mtnStep === 2">
                                                                <div class="step-number">2</div>
                                                                <div class="step-content">
                                                                    <strong>Select option 3: Pay Bills/Services</strong>
                                                                    <small class="d-block text-muted">Choose payment option</small>
                                                                </div>
                                                            </div>
                                                            <div class="process-step" 
                                                                 [class.completed]="mtnStep >= 3" 
                                                                 [class.active]="mtnStep === 3">
                                                                <div class="step-number">3</div>
                                                                <div class="step-content">
                                                                    <strong>Enter merchant code: MKGOV001</strong>
                                                                    <small class="d-block text-muted">MK Gov payment gateway</small>
                                                                </div>
                                                            </div>
                                                            <div class="process-step" 
                                                                 [class.completed]="mtnStep >= 4" 
                                                                 [class.active]="mtnStep === 4">
                                                                <div class="step-number">4</div>
                                                                <div class="step-content">
                                                                    <strong>Enter amount: 110,000 XAF</strong>
                                                                    <small class="d-block text-muted">Passport application fee</small>
                                                                </div>
                                                            </div>
                                                            <div class="process-step" 
                                                                 [class.completed]="mtnStep >= 5" 
                                                                 [class.active]="mtnStep === 5">
                                                                <div class="step-number">5</div>
                                                                <div class="step-content">
                                                                    <strong>Enter your 5-digit PIN</strong>
                                                                    <small class="d-block text-muted">Confirm transaction</small>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <button type="button" class="btn btn-primary w-100" 
                                                                [disabled]="isProcessingPayment || !mtnPaymentData.phoneNumber"
                                                                (click)="processPayment('MTN_MONEY')">
                                                            <span *ngIf="isProcessingPayment && selectedPaymentMethod === 'MTN_MONEY'" 
                                                                  class="spinner-border spinner-border-sm me-2"></span>
                                                            <i class="fas fa-credit-card me-2" *ngIf="!isProcessingPayment"></i>
                                                            {{ isProcessingPayment && selectedPaymentMethod === 'MTN_MONEY' ? 'Processing Payment...' : 'Pay Now' }}
                                                        </button>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </div>
                                    </ngb-accordion-item>

                                    <!-- Orange Money -->
                                    <ngb-accordion-item id="orange-panel" class="payment-method-item">
                                        <div ngbAccordionButton (click)="selectPaymentMethod('ORANGE_MONEY')">
                                            <div class="payment-method-header">
                                                <i class="fas fa-mobile-alt text-warning me-3"></i>
                                                <div>
                                                    <strong>Orange Money</strong>
                                                    <br><small class="text-muted">Pay with your Orange Money account</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div ngbAccordionBody>
                                            <ng-template ngbAccordionContent>
                                                <div class="accordion-body">
                                                    <div class="payment-form" *ngIf="selectedPaymentMethod === 'ORANGE_MONEY'">
                                                        <div class="mb-3">
                                                            <label class="form-label">Orange Phone Number *</label>
                                                            <input type="tel" class="form-control" 
                                                                   [(ngModel)]="orangePaymentData.phoneNumber"
                                                                   [ngModelOptions]="{standalone: true}"
                                                                   placeholder="6xxxxxxxx" maxlength="9">
                                                            <small class="form-text text-muted">Enter your Orange number without country code</small>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <label class="form-label">Merchant Code</label>
                                                            <input type="text" class="form-control" 
                                                                   value="MKGOV002" readonly>
                                                            <small class="form-text text-muted">MK Gov Orange Money merchant code</small>
                                                        </div>

                                                        <!-- Payment Process Steps -->
                                                        <div class="payment-process mb-4" *ngIf="showOrangeProcess">
                                                            <h6 class="mb-3">Payment Process:</h6>
                                                            <div class="process-step" 
                                                                 [class.completed]="orangeStep >= 1" 
                                                                 [class.active]="orangeStep === 1">
                                                                <div class="step-number">1</div>
                                                                <div class="step-content">
                                                                    <strong>Dial #150# on your Orange phone</strong>
                                                                    <small class="d-block text-muted">Access Orange Money menu</small>
                                                                </div>
                                                            </div>
                                                            <div class="process-step" 
                                                                 [class.completed]="orangeStep >= 2" 
                                                                 [class.active]="orangeStep === 2">
                                                                <div class="step-number">2</div>
                                                                <div class="step-content">
                                                                    <strong>Select option 3: Pay Bills</strong>
                                                                    <small class="d-block text-muted">Choose payment option</small>
                                                                </div>
                                                            </div>
                                                            <div class="process-step" 
                                                                 [class.completed]="orangeStep >= 3" 
                                                                 [class.active]="orangeStep === 3">
                                                                <div class="step-number">3</div>
                                                                <div class="step-content">
                                                                    <strong>Enter merchant code: MKGOV002</strong>
                                                                    <small class="d-block text-muted">MK Gov Orange payment gateway</small>
                                                                </div>
                                                            </div>
                                                            <div class="process-step" 
                                                                 [class.completed]="orangeStep >= 4" 
                                                                 [class.active]="orangeStep === 4">
                                                                <div class="step-number">4</div>
                                                                <div class="step-content">
                                                                    <strong>Enter amount: 110,000 XAF</strong>
                                                                    <small class="d-block text-muted">Passport application fee</small>
                                                                </div>
                                                            </div>
                                                            <div class="process-step" 
                                                                 [class.completed]="orangeStep >= 5" 
                                                                 [class.active]="orangeStep === 5">
                                                                <div class="step-number">5</div>
                                                                <div class="step-content">
                                                                    <strong>Enter your 4-digit secret code</strong>
                                                                    <small class="d-block text-muted">Confirm transaction</small>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <button type="button" class="btn btn-warning w-100" 
                                                                [disabled]="isProcessingPayment || !orangePaymentData.phoneNumber"
                                                                (click)="processPayment('ORANGE_MONEY')">
                                                            <span *ngIf="isProcessingPayment && selectedPaymentMethod === 'ORANGE_MONEY'" 
                                                                  class="spinner-border spinner-border-sm me-2"></span>
                                                            <i class="fas fa-credit-card me-2" *ngIf="!isProcessingPayment"></i>
                                                            {{ isProcessingPayment && selectedPaymentMethod === 'ORANGE_MONEY' ? 'Processing Payment...' : 'Pay Now' }}
                                                        </button>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </div>
                                    </ngb-accordion-item>

                                    <!-- Credit Card -->
                                    <ngb-accordion-item id="card-panel" class="payment-method-item">
                                        <div ngbAccordionButton (click)="selectPaymentMethod('CREDIT_CARD')">
                                            <div class="payment-method-header">
                                                <i class="fas fa-credit-card text-success me-3"></i>
                                                <div>
                                                    <strong>Credit/Debit Card</strong>
                                                    <br><small class="text-muted">Pay with Visa, MasterCard or other cards</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div ngbAccordionBody>
                                            <ng-template ngbAccordionContent>
                                                <div class="accordion-body">
                                                    <div class="payment-form" *ngIf="selectedPaymentMethod === 'CREDIT_CARD'">
                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <label class="form-label">Card Number *</label>
                                                                <input type="text" class="form-control" 
                                                                       [(ngModel)]="cardPaymentData.cardNumber"
                                                                       [ngModelOptions]="{standalone: true}"
                                                                       placeholder="1234 5678 9012 3456" 
                                                                       maxlength="19"
                                                                       (input)="formatCardNumber($event)">
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="row mb-3">
                                                            <div class="col-md-6">
                                                                <label class="form-label">Cardholder Name *</label>
                                                                <input type="text" class="form-control" 
                                                                       [(ngModel)]="cardPaymentData.cardholderName"
                                                                       [ngModelOptions]="{standalone: true}"
                                                                       placeholder="JOHN DOE">
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Expiry Date *</label>
                                                                <input type="text" class="form-control" 
                                                                       [(ngModel)]="cardPaymentData.expiryDate"
                                                                       [ngModelOptions]="{standalone: true}"
                                                                       placeholder="MM/YY" 
                                                                       maxlength="5"
                                                                       (input)="formatExpiryDate($event)">
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="row mb-4">
                                                            <div class="col-md-6">
                                                                <label class="form-label">CVV *</label>
                                                                <input type="password" class="form-control" 
                                                                       [(ngModel)]="cardPaymentData.cvv"
                                                                       [ngModelOptions]="{standalone: true}"
                                                                       placeholder="123" 
                                                                       maxlength="4">
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="card-icons mt-4">
                                                                    <i class="fab fa-cc-visa text-primary"></i>
                                                                    <i class="fab fa-cc-mastercard text-warning"></i>
                                                                    <i class="fab fa-cc-amex text-info"></i>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="security-info mb-4">
                                                            <div class="alert alert-info">
                                                                <i class="fas fa-shield-alt me-2"></i>
                                                                <strong>Secure Payment:</strong> Your card information is encrypted and secure.
                                                            </div>
                                                        </div>

                                                        <button type="button" class="btn btn-success w-100" 
                                                                [disabled]="isProcessingPayment || !isCardFormValid()"
                                                                (click)="processPayment('CREDIT_CARD')">
                                                            <span *ngIf="isProcessingPayment && selectedPaymentMethod === 'CREDIT_CARD'" 
                                                                  class="spinner-border spinner-border-sm me-2"></span>
                                                            <i class="fas fa-lock me-2" *ngIf="!isProcessingPayment"></i>
                                                            {{ isProcessingPayment && selectedPaymentMethod === 'CREDIT_CARD' ? 'Processing Payment...' : 'Pay Securely' }}
                                                        </button>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </div>
                                    </ngb-accordion-item>
                                </ngb-accordion>
                            </div>

                            <!-- Payment Status Messages -->
                            <div class="payment-status mt-4" *ngIf="paymentStatus">
                                <div class="alert" 
                                     [class.alert-warning]="paymentStatus === 'pending'"
                                     [class.alert-info]="paymentStatus === 'processing'"
                                     [class.alert-success]="paymentStatus === 'completed'">
                                    <div class="d-flex align-items-center">
                                        <div class="status-icon me-3">
                                            <i class="fas fa-clock" *ngIf="paymentStatus === 'pending'"></i>
                                            <i class="fas fa-spinner fa-spin" *ngIf="paymentStatus === 'processing'"></i>
                                            <i class="fas fa-check-circle" *ngIf="paymentStatus === 'completed'"></i>
                                        </div>
                                        <div>
                                            <strong>Payment Status: {{ paymentStatus | titlecase }}</strong>
                                            <p class="mb-0 mt-1" *ngIf="paymentStatus === 'pending'">
                                                Your payment is being initiated. Please wait...
                                            </p>
                                            <p class="mb-0 mt-1" *ngIf="paymentStatus === 'processing'">
                                                Processing payment verification. This may take a few moments...
                                            </p>
                                            <p class="mb-0 mt-1" *ngIf="paymentStatus === 'completed'">
                                                Votre paiement a bien été effectué. Rendez-vous au centre de production de passeport agréé de votre choix pour la capture de vos données biométriques.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-info mt-3">
                                <i class="fas fa-info-circle me-2"></i>
                                {{ 'messages.payment_simulation' | translate }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="payment-info-card">
                                <h6>Important Information</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check text-success me-2"></i>Secure payment processing</li>
                                    <li><i class="fas fa-check text-success me-2"></i>Instant payment confirmation</li>
                                    <li><i class="fas fa-check text-success me-2"></i>48-hour processing time</li>
                                    <li><i class="fas fa-check text-success me-2"></i>SMS and email notifications</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Biometric Confirmation -->
                <div class="form-step" *ngIf="currentStep === 5">
                    <div class="confirmation-content text-center">
                        <div class="success-icon mb-4">
                            <i class="fas fa-fingerprint fa-4x text-primary"></i>
                        </div>
                        <h3>Biometric Data Capture Required</h3>
                        <p class="text-muted mb-4">Your application has been processed successfully. Now you need to visit an authorized center for biometric enrollment.</p>

                        <div class="biometric-info">
                            <div class="alert alert-info">
                                <h5>Next Steps:</h5>
                                <ol class="text-start">
                                    <li>Visit any authorized DGSN center</li>
                                    <li>Bring your tracking number: <strong>{{ application?.trackingNumber }}</strong></li>
                                    <li>Complete fingerprint and photo capture</li>
                                    <li>Receive your passport collection receipt</li>
                                </ol>
                            </div>
                        </div>

                        <div class="confirmation-details">
                            <div class="detail-item">
                                <strong>Tracking Number:</strong>
                                <span class="text-primary">{{ application?.trackingNumber }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>Expected Processing Time:</strong> 48 hours to 3 months
                            </div>
                            <div class="detail-item">
                                <strong>Status:</strong> Awaiting Biometric Confirmation
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Passport Collection -->
                <div class="form-step" *ngIf="currentStep === 6">
                    <div class="confirmation-content text-center">
                        <div class="success-icon mb-4">
                            <i class="fas fa-passport fa-4x text-success"></i>
                        </div>
                        <h3>Passport Ready for Collection!</h3>
                        <p class="text-muted mb-4">Your biometric passport has been produced and is ready for collection.</p>

                        <div class="confirmation-details">
                            <div class="detail-item">
                                <strong>Tracking Number:</strong>
                                <span class="text-primary">{{ application?.trackingNumber }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>Collection Center:</strong> DGSN Yaoundé
                            </div>
                            <div class="detail-item">
                                <strong>Collection Hours:</strong> Monday-Friday, 8:00 AM - 4:00 PM
                            </div>
                        </div>
                    </div>
                </div>

            </form>

            <!-- Navigation Buttons -->
            <div class="form-navigation mt-4">
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-outline-secondary" *ngIf="currentStep > 1 && currentStep < 5"
                        (click)="previousStep()">
                        <i class="fas fa-arrow-left me-2"></i>
                        Previous
                    </button>

                    <div class="ms-auto">
                        <button type="button" class="btn btn-primary" *ngIf="currentStep < 3" (click)="nextStep()">
                            Next
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>

                        <button type="button" class="btn btn-success" *ngIf="currentStep === 3"
                            [disabled]="isSubmitting || !validateDocumentUploads()" (click)="onSubmitApplication()">
                            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
                            Submit Application
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 4 && paymentStatus === 'completed'"
                            (click)="confirmBiometricStep()">
                            <i class="fas fa-fingerprint me-2"></i>
                            Confirm Biometric Identification
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 4 && !paymentStatus"
                            disabled>
                            <i class="fas fa-credit-card me-2"></i>
                            Select Payment Method
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 5"
                            (click)="currentStep = 6">
                            <i class="fas fa-check me-2"></i>
                            Complete Process
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 6"
                            (click)="goToTracking()">
                            <i class="fas fa-search me-2"></i>
                            Track Application
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>