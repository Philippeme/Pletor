<div class="passport-application-page">
    <div class="container py-4">

        <!-- Page Header -->
        <div class="page-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="page-title">
                        <i class="fas fa-passport me-3"></i>
                        {{ 'passport_application.title' | translate }}
                    </h1>
                    <p class="text-muted">{{ 'passport_application.subtitle' | translate }}</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="tracking-info" *ngIf="application">
                        <div class="tracking-display d-inline-flex align-items-center">
                            <span class="tracking-text">
                                <strong>{{ 'passport_application.tracking_number' | translate }}</strong> {{ application.trackingNumber }}
                            </span>
                            <button class="btn btn-sm btn-outline-primary ms-2" 
                                (click)="copyTrackingNumber()" 
                                [title]="'passport_application.copy_tracking' | translate">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-container mb-5">
            <div class="progress-steps">
                <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
                    <div class="step-circle">1</div>
                    <span class="step-label">{{ 'passport_application.steps.personal_info' | translate }}</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 1"></div>
                <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
                    <div class="step-circle">2</div>
                    <span class="step-label">{{ 'passport_application.steps.contact_details' | translate }}</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 2"></div>
                <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
                    <div class="step-circle">3</div>
                    <span class="step-label">{{ 'passport_application.steps.documents' | translate }}</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 3"></div>
                <div class="step" [class.active]="currentStep >= 4" [class.completed]="currentStep > 4">
                    <div class="step-circle">4</div>
                    <span class="step-label">{{ 'passport_application.steps.payment' | translate }}</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 4"></div>
                <div class="step" [class.active]="currentStep >= 5" [class.completed]="currentStep > 5">
                    <div class="step-circle">5</div>
                    <span class="step-label">{{ 'passport_application.steps.biometric_enrollment' | translate }}</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 5"></div>
                <div class="step" [class.active]="currentStep >= 6" [class.completed]="currentStep >= 6">
                    <div class="step-circle">6</div>
                    <span class="step-label">{{ 'passport_application.steps.collection' | translate }}</span>
                </div>
            </div>
        </div>

        <!-- Application Form -->
        <div class="application-form">

            <!-- Error/Success Messages -->
            <div class="alert alert-danger" *ngIf="errorMessage" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                {{ errorMessage }}
            </div>

            <div class="alert alert-success" *ngIf="successMessage" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                {{ successMessage }}
            </div>

            <form [formGroup]="passportForm">

                <!-- Step 1: Personal Information -->
                <div class="form-step" *ngIf="currentStep === 1">
                    <div class="step-header mb-4">
                        <h3>{{ 'passport_application.form.personal_info_title' | translate }}</h3>
                        <p class="text-muted">{{ 'passport_application.form.personal_info_subtitle' | translate }}</p>
                    </div>

                    <!-- Request Type -->
                    <div class="mb-4">
                        <label class="form-label">{{ 'passport_application.form.request_for' | translate }} *</label>
                        <div class="request-type-selection">
                            <div class="form-check form-check-card">
                                <input class="form-check-input" type="radio" value="self" formControlName="requestType"
                                    id="self" (change)="onRequestTypeChange()">
                                <label class="form-check-label" for="self">
                                    <div class="card-content">
                                        <i class="fas fa-user fa-2x mb-2"></i>
                                        <h6>{{ 'passport_application.form.for_myself' | translate }}</h6>
                                        <small class="text-muted">{{ 'passport_application.form.for_myself_desc' | translate }}</small>
                                    </div>
                                </label>
                            </div>
                            <div class="form-check form-check-card">
                                <input class="form-check-input" type="radio" value="child" formControlName="requestType"
                                    id="child" (change)="onRequestTypeChange()">
                                <label class="form-check-label" for="child">
                                    <div class="card-content">
                                        <i class="fas fa-child fa-2x mb-2"></i>
                                        <h6>{{ 'passport_application.form.for_child' | translate }}</h6>
                                        <small class="text-muted">{{ 'passport_application.form.for_child_desc' | translate }}</small>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information -->
                    <h5 class="mb-3">{{ getPersonSectionTitle() }}</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.first_name' | translate }} *</label>
                            <input type="text" class="form-control" formControlName="firstName"
                                [class.is-invalid]="passportForm.get('firstName')?.invalid && passportForm.get('firstName')?.touched">
                            <div class="invalid-feedback">{{ 'passport_application.form.first_name_required' | translate }}</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.middle_name' | translate }}</label>
                            <input type="text" class="form-control" formControlName="middleName">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.last_name' | translate }} *</label>
                            <input type="text" class="form-control" formControlName="lastName"
                                [class.is-invalid]="passportForm.get('lastName')?.invalid && passportForm.get('lastName')?.touched">
                            <div class="invalid-feedback">{{ 'passport_application.form.last_name_required' | translate }}</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.date_of_birth' | translate }} *</label>
                            <input type="date" class="form-control" formControlName="dateOfBirth"
                                [class.is-invalid]="passportForm.get('dateOfBirth')?.invalid && passportForm.get('dateOfBirth')?.touched">
                            <div class="invalid-feedback">{{ 'passport_application.form.date_birth_required' | translate }}</div>
                            <small class="form-text text-muted" *ngIf="passportForm.get('dateOfBirth')?.value">
                                {{ 'passport_application.form.age_label' | translate }} 
                                {{ calculateAge(passportForm.get('dateOfBirth')?.value) }} 
                                {{ 'passport_application.form.years_label' | translate }}
                            </small>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.place_of_birth' | translate }} *</label>
                            <input type="text" class="form-control" formControlName="placeOfBirth"
                                [class.is-invalid]="passportForm.get('placeOfBirth')?.invalid && passportForm.get('placeOfBirth')?.touched">
                            <div class="invalid-feedback">{{ 'passport_application.form.place_birth_required' | translate }}</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.nationality' | translate }} *</label>
                            <input type="text" class="form-control" formControlName="nationality" readonly>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{{ 'passport_application.form.gender' | translate }} *</label>
                            <select class="form-select" formControlName="gender"
                                [class.is-invalid]="passportForm.get('gender')?.invalid && passportForm.get('gender')?.touched">
                                <option value="">{{ 'passport_application.form.select_gender' | translate }}</option>
                                <option value="Male">{{ 'passport_application.form.male' | translate }}</option>
                                <option value="Female">{{ 'passport_application.form.female' | translate }}</option>
                            </select>
                            <div class="invalid-feedback">{{ 'passport_application.form.gender_required' | translate }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{{ 'passport_application.form.marital_status' | translate }} *</label>
                            <select class="form-select" formControlName="maritalStatus"
                                [class.is-invalid]="passportForm.get('maritalStatus')?.invalid && passportForm.get('maritalStatus')?.touched">
                                <option value="">{{ 'passport_application.form.select_marital_status' | translate }}</option>
                                <option value="Single">{{ 'passport_application.form.single' | translate }}</option>
                                <option value="Married">{{ 'passport_application.form.married' | translate }}</option>
                                <option value="Divorced">{{ 'passport_application.form.divorced' | translate }}</option>
                                <option value="Widowed">{{ 'passport_application.form.widowed' | translate }}</option>
                            </select>
                            <div class="invalid-feedback">{{ 'passport_application.form.marital_status_required' | translate }}</div>
                        </div>
                    </div>

                    <!-- Relationship section for non-self applications -->
                    <div class="row" *ngIf="passportForm.get('requestType')?.value === 'child'">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{{ 'passport_application.form.relationship_to_applicant' | translate }} *</label>
                            <select class="form-select" formControlName="relationshipToApplicant">
                                <option value="">{{ 'passport_application.form.select_relationship' | translate }}</option>
                                <option value="Parent">{{ 'passport_application.form.parent' | translate }}</option>
                                <option value="Guardian">{{ 'passport_application.form.guardian' | translate }}</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{{ 'passport_application.form.guardian_phone' | translate }} *</label>
                            <input type="tel" class="form-control" formControlName="guardianPhone">
                        </div>
                    </div>
                </div>

                <!-- Step 2: Contact Information -->
                <div class="form-step" *ngIf="currentStep === 2">
                    <div class="step-header mb-4">
                        <h3>{{ 'passport_application.form.contact_emergency_title' | translate }}</h3>
                        <p class="text-muted">{{ 'passport_application.form.contact_emergency_subtitle' | translate }}</p>
                    </div>

                    <!-- Contact Information -->
                    <h5 class="mb-3">{{ 'passport_application.form.contact_information' | translate }}</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{{ 'passport_application.form.phone_number' | translate }} *</label>
                            <input type="tel" class="form-control" formControlName="phoneNumber"
                                [class.is-invalid]="passportForm.get('phoneNumber')?.invalid && passportForm.get('phoneNumber')?.touched">
                            <div class="invalid-feedback">{{ 'passport_application.form.phone_required' | translate }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{{ 'passport_application.form.email_address' | translate }} *</label>
                            <input type="email" class="form-control" formControlName="email"
                                [class.is-invalid]="passportForm.get('email')?.invalid && passportForm.get('email')?.touched">
                            <div class="invalid-feedback">{{ 'passport_application.form.email_required' | translate }}</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{{ 'passport_application.form.current_address' | translate }} *</label>
                            <textarea class="form-control" rows="3" formControlName="currentAddress"
                                [class.is-invalid]="passportForm.get('currentAddress')?.invalid && passportForm.get('currentAddress')?.touched"></textarea>
                            <div class="invalid-feedback">{{ 'passport_application.form.current_address_required' | translate }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{{ 'passport_application.form.permanent_address' | translate }} *</label>
                            <textarea class="form-control" rows="3" formControlName="permanentAddress"
                                [class.is-invalid]="passportForm.get('permanentAddress')?.invalid && passportForm.get('permanentAddress')?.touched"></textarea>
                            <div class="invalid-feedback">{{ 'passport_application.form.permanent_address_required' | translate }}</div>
                        </div>
                    </div>

                    <!-- Emergency Contact -->
                    <h5 class="mb-3 mt-4">{{ 'passport_application.form.emergency_contact' | translate }}</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.full_name' | translate }} *</label>
                            <input type="text" class="form-control" formControlName="emergencyContactName"
                                [class.is-invalid]="passportForm.get('emergencyContactName')?.invalid && passportForm.get('emergencyContactName')?.touched">
                            <div class="invalid-feedback">{{ 'passport_application.form.emergency_name_required' | translate }}</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.phone_number' | translate }} *</label>
                            <input type="tel" class="form-control" formControlName="emergencyContactPhone"
                                [class.is-invalid]="passportForm.get('emergencyContactPhone')?.invalid && passportForm.get('emergencyContactPhone')?.touched">
                            <div class="invalid-feedback">{{ 'passport_application.form.emergency_phone_required' | translate }}</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ 'passport_application.form.relationship' | translate }} *</label>
                            <select class="form-select" formControlName="emergencyContactRelation"
                                [class.is-invalid]="passportForm.get('emergencyContactRelation')?.invalid && passportForm.get('emergencyContactRelation')?.touched">
                                <option value="">{{ 'passport_application.form.select_relationship' | translate }}</option>
                                <option value="Parent">{{ 'passport_application.form.parent' | translate }}</option>
                                <option value="Spouse">{{ 'passport_application.form.spouse' | translate }}</option>
                                <option value="Sibling">{{ 'passport_application.form.sibling' | translate }}</option>
                                <option value="Child">{{ 'passport_application.form.child' | translate }}</option>
                                <option value="Friend">{{ 'passport_application.form.friend' | translate }}</option>
                                <option value="Other">{{ 'passport_application.form.other' | translate }}</option>
                            </select>
                            <div class="invalid-feedback">{{ 'passport_application.form.emergency_relation_required' | translate }}</div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Document Upload -->
                <div class="form-step" *ngIf="currentStep === 3">
                    <div class="step-header mb-4">
                        <h3>{{ 'passport_application.form.required_documents_title' | translate }}</h3>
                        <p class="text-muted">{{ 'passport_application.form.required_documents_subtitle' | translate }}</p>
                    </div>

                    <div class="documents-grid">
                        <div class="document-item" *ngFor="let doc of requiredDocuments">
                            <div class="document-header">
                                <h6 class="document-name">
                                    {{ 'passport_application.documents.' + doc.id | translate }}
                                    <span class="badge bg-danger ms-2" *ngIf="doc.required">{{ 'passport_application.form.required' | translate }}</span>
                                    <span class="badge bg-secondary ms-2" *ngIf="!doc.required">{{ 'passport_application.form.optional' | translate }}</span>
                                </h6>
                            </div>

                            <div class="document-upload" *ngIf="!uploadedFiles[doc.id]">
                                <input type="file" [id]="'file-' + doc.id" (change)="onFileUpload($event, doc.id)"
                                    accept=".pdf,.jpg,.jpeg,.png" class="d-none">
                                <label [for]="'file-' + doc.id" class="upload-label">
                                    <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                    <span>{{ 'passport_application.form.click_upload' | translate }}</span>
                                    <small class="text-muted d-block">{{ 'passport_application.form.file_types' | translate }}</small>
                                </label>
                            </div>

                            <div class="document-uploaded" *ngIf="uploadedFiles[doc.id]">
                                <div class="uploaded-file">
                                    <div class="file-info">
                                        <i class="fas fa-file-alt fa-2x text-success me-3"></i>
                                        <div>
                                            <strong>{{ uploadedFiles[doc.id].name }}</strong>
                                            <small class="text-muted d-block">{{ (uploadedFiles[doc.id].size /
                                                1024).toFixed(1) }} KB</small>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-outline-danger btn-sm"
                                        (click)="removeFile(doc.id)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Payment -->
                <div class="form-step" *ngIf="currentStep === 4">
                    <div class="step-header mb-4">
                        <h3>{{ 'passport_application.payment.title' | translate }}</h3>
                        <p class="text-muted">{{ 'passport_application.payment.subtitle' | translate }}</p>
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="payment-summary mb-4">
                                <h5>{{ 'passport_application.payment.summary' | translate }}</h5>
                                <div class="fee-item">
                                    <div class="d-flex justify-content-between">
                                        <span>{{ 'passport_application.payment.application_fee' | translate }}</span>
                                        <span>110,000 XAF</span>
                                    </div>
                                </div>
                                <hr>
                                <div class="total-amount">
                                    <div class="d-flex justify-content-between">
                                        <strong>{{ 'passport_application.payment.total_amount' | translate }}</strong>
                                        <strong class="text-primary">{{ calculateTotalAmount() }} XAF</strong>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Already Completed Message -->
                            <div class="alert alert-info mb-4" *ngIf="hasPaymentCompleted">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-check-circle fa-2x text-success me-3"></i>
                                    <div>
                                        <h6 class="mb-1">{{ 'passport_application.payment.payment_completed' | translate }}</h6>
                                        <p class="mb-0">{{ 'passport_application.payment.payment_completed_desc' | translate }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Methods with Accordions -->
                            <div class="payment-methods" *ngIf="!hasPaymentCompleted">
                                <h5 class="mb-3">{{ 'passport_application.payment.select_method' | translate }}</h5>
                                
                                <!-- MTN Mobile Money -->
                                <div class="payment-accordion mb-3" [class.disabled]="arePaymentMethodsDisabled()">
                                    <div class="accordion-header" (click)="togglePaymentAccordion('mtn')">
                                        <div class="payment-method-option">
                                            <input type="radio" name="paymentMethod" value="mtn" 
                                                [checked]="activePaymentMethod === 'mtn'" [disabled]="arePaymentMethodsDisabled()">
                                            <i class="fas fa-mobile-alt me-3"></i>
                                            <span>MTN Mobile Money</span>
                                            <i class="fas fa-chevron-down ms-auto" 
                                                [class.rotated]="showMtnAccordion"></i>
                                        </div>
                                    </div>
                                    <div class="accordion-content" [class.show]="showMtnAccordion">
                                        <!-- MTN Payment Instructions -->
                                        <div class="payment-instructions mb-3">
                                            <h6 class="text-primary">
                                                <i class="fas fa-info-circle me-2"></i>
                                                {{ 'birth_certificate.payment.mtn_process' | translate }}
                                            </h6>
                                            <div class="instruction-steps">
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_1' | translate }}</strong> {{ 'passport_application.payment.dial_ussd' | translate }}
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_2' | translate }}</strong> {{ 'passport_application.payment.select_bill_payment' | translate }}
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_3' | translate }}</strong> {{ 'passport_application.payment.enter_merchant_code' | translate }}
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_4' | translate }}</strong> {{ 'passport_application.payment.enter_amount' | translate }} <strong>{{ calculateTotalAmount() }} XAF</strong>
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_5' | translate }}</strong> {{ 'passport_application.payment.transaction_id_sms' | translate }}
                                                </div>
                                            </div>
                                        </div>

                                        <form [formGroup]="mtnForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'birth_certificate.payment.mtn_phone' | translate }} *</label>
                                                    <input type="tel" class="form-control" formControlName="phoneNumber"
                                                        [placeholder]="'birth_certificate.payment.mtn_phone_placeholder' | translate"
                                                        [class.is-invalid]="mtnForm.get('phoneNumber')?.invalid && mtnForm.get('phoneNumber')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="mtnForm.get('phoneNumber')?.errors?.['required']">
                                                            {{ 'birth_certificate.payment.mtn_phone_required' | translate }}
                                                        </small>
                                                        <small *ngIf="mtnForm.get('phoneNumber')?.errors?.['pattern']">
                                                            {{ 'birth_certificate.payment.mtn_phone_invalid' | translate }}
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'birth_certificate.payment.merchant_code' | translate }}</label>
                                                    <input type="text" class="form-control" formControlName="merchantCode"
                                                        readonly>
                                                    <small class="form-text text-muted">{{ 'birth_certificate.payment.merchant_code_desc' | translate }}</small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'birth_certificate.payment.amount' | translate }}</label>
                                                    <input type="text" class="form-control" formControlName="amount"
                                                        readonly>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'birth_certificate.payment.transaction_id' | translate }} *</label>
                                                    <input type="text" class="form-control" formControlName="transactionId"
                                                        [placeholder]="'birth_certificate.payment.transaction_id_placeholder' | translate"
                                                        [class.is-invalid]="mtnForm.get('transactionId')?.invalid && mtnForm.get('transactionId')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="mtnForm.get('transactionId')?.errors?.['required']">
                                                            {{ 'birth_certificate.payment.transaction_id_required' | translate }}
                                                        </small>
                                                        <small *ngIf="mtnForm.get('transactionId')?.errors?.['pattern']">
                                                            {{ 'birth_certificate.payment.transaction_id_invalid' | translate }}
                                                        </small>
                                                    </div>
                                                    <small class="form-text text-muted">{{ 'birth_certificate.payment.transaction_id_desc' | translate }}</small>
                                                </div>
                                            </div>

                                            <button type="button" class="btn btn-warning" 
                                                [disabled]="isProcessingPayment || mtnForm.invalid"
                                                (click)="processMtnPayment()">
                                                <span *ngIf="isProcessingPayment && activePaymentMethod === 'mtn'" 
                                                    class="spinner-border spinner-border-sm me-2"></span>
                                                {{ 'birth_certificate.payment.pay_now' | translate }}
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Orange Money -->
                                <div class="payment-accordion mb-3" [class.disabled]="arePaymentMethodsDisabled()">
                                    <div class="accordion-header" (click)="togglePaymentAccordion('orange')">
                                        <div class="payment-method-option">
                                            <input type="radio" name="paymentMethod" value="orange" 
                                                [checked]="activePaymentMethod === 'orange'" [disabled]="arePaymentMethodsDisabled()">
                                            <i class="fas fa-mobile-alt me-3"></i>
                                            <span>Orange Money</span>
                                            <i class="fas fa-chevron-down ms-auto" 
                                                [class.rotated]="showOrangeAccordion"></i>
                                        </div>
                                    </div>
                                    <div class="accordion-content" [class.show]="showOrangeAccordion">
                                        <!-- Orange Payment Instructions -->
                                        <div class="payment-instructions mb-3">
                                            <h6 class="text-primary">
                                                <i class="fas fa-info-circle me-2"></i>
                                                {{ 'passport_application.payment.orange_process' | translate }}
                                            </h6>
                                            <div class="instruction-steps">
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_1' | translate }}</strong> {{ 'passport_application.payment.orange_ussd' | translate }}
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_2' | translate }}</strong> {{ 'passport_application.payment.orange_merchant' | translate }}
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_3' | translate }}</strong> {{ 'passport_application.payment.orange_amount' | translate }} <strong>{{ calculateTotalAmount() }} XAF</strong>
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_4' | translate }}</strong> {{ 'passport_application.payment.orange_transaction_sms' | translate }}
                                                </div>
                                            </div>
                                        </div>

                                        <form [formGroup]="orangeForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.orange_phone' | translate }} *</label>
                                                    <input type="tel" class="form-control" formControlName="phoneNumber"
                                                        [placeholder]="'passport_application.payment.orange_phone_placeholder' | translate"
                                                        [class.is-invalid]="orangeForm.get('phoneNumber')?.invalid && orangeForm.get('phoneNumber')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="orangeForm.get('phoneNumber')?.errors?.['required']">
                                                            {{ 'passport_application.payment.orange_phone_required' | translate }}
                                                        </small>
                                                        <small *ngIf="orangeForm.get('phoneNumber')?.errors?.['pattern']">
                                                            {{ 'passport_application.payment.orange_phone_invalid' | translate }}
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.merchant_code' | translate }}</label>
                                                    <input type="text" class="form-control" formControlName="merchantCode" readonly>
                                                    <small class="form-text text-muted">{{ 'passport_application.payment.merchant_code_desc' | translate }}</small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.amount' | translate }}</label>
                                                    <input type="text" class="form-control" formControlName="amount" readonly>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.transaction_id' | translate }} *</label>
                                                    <input type="text" class="form-control" formControlName="transactionId"
                                                        [placeholder]="'passport_application.payment.orange_transaction_placeholder' | translate"
                                                        [class.is-invalid]="orangeForm.get('transactionId')?.invalid && orangeForm.get('transactionId')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="orangeForm.get('transactionId')?.errors?.['required']">
                                                            {{ 'passport_application.payment.transaction_id_required' | translate }}
                                                        </small>
                                                        <small *ngIf="orangeForm.get('transactionId')?.errors?.['pattern']">
                                                            {{ 'passport_application.payment.orange_transaction_format' | translate }}
                                                        </small>
                                                    </div>
                                                    <small class="form-text text-muted">{{ 'passport_application.payment.orange_transaction_desc' | translate }}</small>
                                                </div>
                                            </div>

                                            <button type="button" class="btn btn-warning" 
                                                [disabled]="isProcessingPayment || orangeForm.invalid"
                                                (click)="processOrangePayment()">
                                                <span *ngIf="isProcessingPayment && activePaymentMethod === 'orange'" 
                                                    class="spinner-border spinner-border-sm me-2"></span>
                                                {{ 'passport_application.payment.pay_now' | translate }}
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Visa Credit Card -->
                                <div class="payment-accordion mb-3" [class.disabled]="arePaymentMethodsDisabled()">
                                    <div class="accordion-header" (click)="togglePaymentAccordion('visa')">
                                        <div class="payment-method-option">
                                            <input type="radio" name="paymentMethod" value="visa" 
                                                [checked]="activePaymentMethod === 'visa'" [disabled]="arePaymentMethodsDisabled()">
                                            <i class="fas fa-credit-card me-3"></i>
                                            <span>{{ 'passport_application.payment.visa_credit_card' | translate }}</span>
                                            <i class="fas fa-chevron-down ms-auto" 
                                                [class.rotated]="showVisaAccordion"></i>
                                        </div>
                                    </div>
                                    <div class="accordion-content" [class.show]="showVisaAccordion">
                                        <!-- Visa Payment Instructions -->
                                        <div class="payment-instructions mb-3">
                                            <h6 class="text-primary">
                                                <i class="fas fa-info-circle me-2"></i>
                                                {{ 'passport_application.payment.visa_process' | translate }}
                                            </h6>
                                            <div class="instruction-steps">
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_1' | translate }}</strong> {{ 'passport_application.payment.visa_step1' | translate }}
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_2' | translate }}</strong> {{ 'passport_application.payment.visa_step2' | translate }}
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_3' | translate }}</strong> {{ 'passport_application.payment.visa_step3' | translate }}
                                                </div>
                                                <div class="step-item">
                                                    <strong>{{ 'passport_application.payment.steps.step_4' | translate }}</strong> {{ 'passport_application.payment.visa_step4' | translate }}
                                                </div>
                                            </div>
                                        </div>

                                        <form [formGroup]="visaForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.card_number' | translate }} *</label>
                                                    <input type="text" class="form-control" formControlName="cardNumber"
                                                        [placeholder]="'passport_application.payment.card_number_placeholder' | translate"
                                                        maxlength="19"
                                                        (input)="onCardNumberInput($event)"
                                                        (keypress)="onCardNumberKeypress($event)"
                                                        [class.is-invalid]="visaForm.get('cardNumber')?.invalid && visaForm.get('cardNumber')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="visaForm.get('cardNumber')?.errors?.['required']">
                                                            {{ 'passport_application.payment.card_number_required' | translate }}
                                                        </small>
                                                        <small *ngIf="visaForm.get('cardNumber')?.errors?.['creditCard']">
                                                            {{ 'passport_application.payment.card_number_invalid' | translate }}
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.expiry_date' | translate }} *</label>
                                                    <input type="text" class="form-control" formControlName="expiryDate"
                                                        [placeholder]="'passport_application.payment.expiry_date_placeholder' | translate"
                                                        maxlength="5"
                                                        (input)="onExpiryDateInput($event)"
                                                        (keypress)="onExpiryDateKeypress($event)"
                                                        [class.is-invalid]="visaForm.get('expiryDate')?.invalid && visaForm.get('expiryDate')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="visaForm.get('expiryDate')?.errors?.['required']">
                                                            {{ 'passport_application.payment.expiry_required' | translate }}
                                                        </small>
                                                        <small *ngIf="visaForm.get('expiryDate')?.errors?.['pattern']">
                                                            {{ 'passport_application.payment.expiry_invalid' | translate }}
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.cvv' | translate }} *</label>
                                                    <input type="text" class="form-control" formControlName="cvv"
                                                        [placeholder]="'passport_application.payment.cvv_placeholder' | translate"
                                                        maxlength="3"
                                                        (keypress)="onCvvKeypress($event)"
                                                        [class.is-invalid]="visaForm.get('cvv')?.invalid && visaForm.get('cvv')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="visaForm.get('cvv')?.errors?.['required']">
                                                            {{ 'passport_application.payment.cvv_required' | translate }}
                                                        </small>
                                                        <small *ngIf="visaForm.get('cvv')?.errors?.['pattern']">
                                                            {{ 'passport_application.payment.cvv_invalid' | translate }}
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.cardholder_name' | translate }} *</label>
                                                    <input type="text" class="form-control" formControlName="cardholderName"
                                                        [placeholder]="'passport_application.payment.cardholder_placeholder' | translate"
                                                        [class.is-invalid]="visaForm.get('cardholderName')?.invalid && visaForm.get('cardholderName')?.touched">
                                                    <div class="invalid-feedback">
                                                        {{ 'passport_application.payment.cardholder_required' | translate }}
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">{{ 'passport_application.payment.amount' | translate }}</label>
                                                    <input type="text" class="form-control" formControlName="amount" readonly>
                                                </div>
                                            </div>

                                            <button type="button" class="btn btn-warning" 
                                                [disabled]="isProcessingPayment || visaForm.invalid"
                                                (click)="processVisaPayment()">
                                                <span *ngIf="isProcessingPayment && activePaymentMethod === 'visa'" 
                                                    class="spinner-border spinner-border-sm me-2"></span>
                                                {{ 'passport_application.payment.pay_now' | translate }}
                                            </button>
                                        </form>
                                    </div>
                                </div>

                            </div>

                            <!-- Payment Status Messages -->
                            <div class="alert alert-info mt-3" *ngIf="paymentStatusPending">
                                <i class="fas fa-clock me-2"></i>
                                {{ 'birth_certificate.payment.payment_pending' | translate }}
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="delivery-info-card">
                                <h6>{{ 'passport_application.payment.service_info' | translate }}</h6>
                                <div class="info-item">
                                    <i class="fas fa-clock text-primary me-2"></i>
                                    <strong>{{ 'passport_application.payment.processing_time' | translate }}</strong>
                                    <br>
                                    <span class="text-muted">{{ 'passport_application.payment.processing_time_desc' | translate }}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-shield-alt text-success me-2"></i>
                                    <strong>{{ 'passport_application.payment.security_features' | translate }}</strong>
                                    <br>
                                    <span class="text-muted">{{ 'passport_application.payment.security_desc' | translate }}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-calendar text-info me-2"></i>
                                    <strong>{{ 'passport_application.payment.validity' | translate }}</strong>
                                    <br>
                                    <span class="text-muted">{{ 'passport_application.payment.validity_desc' | translate }}</span>
                                </div>
                            </div>

                            <!-- Payment Processing Section -->
                            <div class="payment-processing-card mb-3" *ngIf="showRefreshButton">
                                <h6 class="text-primary">
                                    <i class="fas fa-credit-card me-2"></i>
                                    {{ 'passport_application.payment.payment_under_process' | translate }}
                                </h6>
                                <p class="text-muted mb-3">{{ 'passport_application.payment.payment_wait' | translate }}</p>
                                <button class="btn btn-outline-primary w-100" (click)="refreshPaymentStatus()">
                                    <i class="fas fa-sync-alt me-2"></i>
                                    {{ 'birth_certificate.payment.refresh_status' | translate }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Biometric Enrollment -->
                <div class="form-step" *ngIf="currentStep === 5">
                    <div class="step-header mb-4">
                        <h3>{{ 'passport_application.biometric.title' | translate }}</h3>
                        <p class="text-muted">{{ 'passport_application.biometric.subtitle' | translate }}</p>
                    </div>

                    <div class="row">
                        <div class="col-lg-8">
                            <!-- Appointment Confirmation -->
                            <div class="appointment-confirmation">
                                <div class="appointment-card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            {{ 'passport_application.biometric.appointment_confirmed' | translate }}
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <!-- Appointment Details Table -->
                                        <div class="appointment-table-container mb-4">
                                            <table class="table table-bordered appointment-details-table">
                                                <tbody>
                                                    <tr>
                                                        <td class="detail-label">
                                                            <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                                            <strong>{{ 'passport_application.biometric.center' | translate }}</strong>
                                                        </td>
                                                        <td class="detail-value">{{ 'passport_application.centers.bissau-central' | translate }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="detail-label">
                                                            <i class="fas fa-calendar text-primary me-2"></i>
                                                            <strong>{{ 'passport_application.biometric.date' | translate }}</strong>
                                                        </td>
                                                        <td class="detail-value">{{ getAppointmentDate() }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="detail-label">
                                                            <i class="fas fa-clock text-primary me-2"></i>
                                                            <strong>{{ 'passport_application.biometric.time' | translate }}</strong>
                                                        </td>
                                                        <td class="detail-value">10:00 AM</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="detail-label">
                                                            <i class="fas fa-hashtag text-primary me-2"></i>
                                                            <strong>{{ 'passport_application.biometric.reference' | translate }}</strong>
                                                        </td>
                                                        <td class="detail-value">DGSN-{{ generateAppointmentReference() }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="detail-label">
                                                            <i class="fas fa-phone text-primary me-2"></i>
                                                            <strong>{{ 'passport_application.biometric.contact' | translate }}</strong>
                                                        </td>
                                                        <td class="detail-value">656789827</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="alert alert-warning">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            <strong>{{ 'passport_application.biometric.important' | translate }}</strong> {{ 'passport_application.biometric.arrive_early' | translate }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Biometric Submission Processing Section -->
                            <div class="biometric-processing-card mt-4" *ngIf="shouldShowBiometricProcessing()">
                                <h6 class="text-primary">
                                    <i class="fas fa-fingerprint me-2"></i>
                                    {{ 'passport_application.biometric.enrollment_ongoing' | translate }}
                                </h6>
                                <p class="text-muted mb-3">
                                    {{ 'passport_application.biometric.enrollment_desc' | translate }}
                                </p>
                                <button class="btn btn-success w-100 mb-3" 
                                    [disabled]="isProcessingBiometric"
                                    (click)="submitBiometricRequest()">
                                    <span *ngIf="isProcessingBiometric" class="spinner-border spinner-border-sm me-2"></span>
                                    <i class="fas fa-info-circle me-2" *ngIf="!isProcessingBiometric"></i>
                                    {{ 'passport_application.biometric.check_status' | translate }}
                                </button>
                                <button class="btn btn-outline-primary w-100" 
                                    *ngIf="showBiometricRefreshButton"
                                    (click)="refreshBiometricStatus()">
                                    <i class="fas fa-sync-alt me-2"></i>
                                    {{ 'passport_application.biometric.refresh_status' | translate }}
                                </button>
                            </div>

                            <!-- Biometric confirmation message -->
                            <div class="biometric-confirmation-message mt-4" *ngIf="shouldShowBiometricConfirmation()">
                                <div class="alert alert-success border-0" style="background: linear-gradient(135deg, #d4edda, #c3e6cb);">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-check-circle fa-3x text-success me-3"></i>
                                        <div>
                                            <h5 class="mb-1 text-success">{{ 'passport_application.biometric.request_submitted' | translate }}</h5>
                                            <p class="mb-0">{{ 'passport_application.biometric.request_processed' | translate }}</p>
                                        </div>
                                    </div>
                                    <div class="confirmation-text">
                                        <p class="mb-2">
                                            <strong>{{ 'passport_application.biometric.click_next' | translate }}</strong>
                                        </p>
                                        <p class="mb-0">
                                            {{ 'passport_application.biometric.contact_support' | translate }}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Biometric Process Information -->
                            <div class="biometric-process-info mt-4" *ngIf="showBiometricInstructions && !shouldShowBiometricConfirmation()">
                                <h5 class="mb-3">
                                    <i class="fas fa-fingerprint me-2"></i>
                                    {{ 'passport_application.biometric.what_to_expect' | translate }}
                                </h5>

                                <div class="process-steps">
                                    <div class="process-step">
                                        <div class="step-number">1</div>
                                        <div class="step-content">
                                            <h6>{{ 'passport_application.biometric.document_verification' | translate }}</h6>
                                            <p>{{ 'passport_application.biometric.document_verification_desc' | translate }}</p>
                                        </div>
                                    </div>
                                    <div class="process-step">
                                        <div class="step-number">2</div>
                                        <div class="step-content">
                                            <h6>{{ 'passport_application.biometric.biometric_photo' | translate }}</h6>
                                            <p>{{ 'passport_application.biometric.biometric_photo_desc' | translate }}</p>
                                        </div>
                                    </div>
                                    <div class="process-step">
                                        <div class="step-number">3</div>
                                        <div class="step-content">
                                            <h6>{{ 'passport_application.biometric.fingerprint_capture' | translate }}</h6>
                                            <p>{{ 'passport_application.biometric.fingerprint_desc' | translate }}</p>
                                        </div>
                                    </div>
                                    <div class="process-step">
                                        <div class="step-number">4</div>
                                        <div class="step-content">
                                            <h6>{{ 'passport_application.biometric.digital_signature' | translate }}</h6>
                                            <p>{{ 'passport_application.biometric.digital_signature_desc' | translate }}</p>
                                        </div>
                                    </div>
                                    <div class="process-step">
                                        <div class="step-number">5</div>
                                        <div class="step-content">
                                            <h6>{{ 'passport_application.biometric.height_measurement' | translate }}</h6>
                                            <p>{{ 'passport_application.biometric.height_desc' | translate }}</p>
                                        </div>
                                    </div>
                                    <div class="process-step">
                                        <div class="step-number">6</div>
                                        <div class="step-content">
                                            <h6>{{ 'passport_application.biometric.data_validation' | translate }}</h6>
                                            <p>{{ 'passport_application.biometric.data_validation_desc' | translate }}</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Duration Information -->
                                <div class="alert alert-info mt-4" *ngIf="showBiometricInstructions">
                                    <i class="fas fa-clock me-2"></i>
                                    <strong>{{ 'passport_application.biometric.duration' | translate }}</strong> {{ 'passport_application.biometric.duration_desc' | translate }}
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <!-- Required Documents for Appointment -->
                            <div class="required-docs-card">
                                <h6>
                                    <i class="fas fa-clipboard-list me-2"></i>
                                    {{ 'passport_application.biometric.bring_to_appointment' | translate }}
                                </h6>
                                <ul class="docs-checklist">
                                    <li>
                                        <i class="fas fa-check text-success me-2"></i>
                                        {{ 'passport_application.biometric.original_birth_certificate' | translate }}
                                    </li>
                                    <li>
                                        <i class="fas fa-check text-success me-2"></i>
                                        {{ 'passport_application.biometric.original_national_id' | translate }}
                                    </li>
                                    <li>
                                        <i class="fas fa-check text-success me-2"></i>
                                        {{ 'passport_application.biometric.appointment_confirmation' | translate }}
                                    </li>
                                    <li>
                                        <i class="fas fa-check text-success me-2"></i>
                                        {{ 'passport_application.biometric.payment_receipt' | translate }}
                                    </li>
                                    <li>
                                        <i class="fas fa-check text-success me-2"></i>
                                        {{ 'passport_application.biometric.marriage_certificate_if' | translate }}
                                    </li>
                                </ul>
                            </div>

                            <!-- Contact Information -->
                            <div class="contact-info-card mt-3">
                                <h6>
                                    <i class="fas fa-phone me-2"></i>
                                    {{ 'passport_application.biometric.need_help' | translate }}
                                </h6>
                                <div class="contact-item">
                                    <strong>{{ 'passport_application.biometric.dgsn_hotline' | translate }}</strong><br>
                                    <span class="text-muted">+245 123 456 789</span>
                                </div>
                                <div class="contact-item">
                                    <strong>{{ 'passport_application.biometric.email_support' | translate }}</strong><br>
                                    <span class="text-muted">passport@dgsn.gov.gw</span>
                                </div>
                                <div class="contact-item">
                                    <strong>{{ 'passport_application.biometric.office_hours' | translate }}</strong><br>
                                    <span class="text-muted">{{ 'passport_application.biometric.office_hours_desc' | translate }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Collection Confirmation -->
                <div class="form-step" *ngIf="currentStep === 6">
                    <div class="confirmation-content text-center">
                        <div class="success-icon mb-4">
                            <i class="fas fa-check-circle fa-4x text-success"></i>
                        </div>
                        <h3>{{ 'passport_application.collection.success_title' | translate }}</h3>
                        <p class="text-muted mb-4">{{ 'passport_application.collection.success_desc' | translate }}</p>

                        <div class="confirmation-details">
                            <div class="detail-item">
                                <strong>{{ 'passport_application.collection.tracking_number' | translate }}</strong>
                                <span class="text-primary">{{ application?.trackingNumber }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>{{ 'passport_application.collection.application_type' | translate }}</strong> {{ 'passport_application.collection.biometric_passport' | translate }}
                            </div>
                            <div class="detail-item">
                                <strong>{{ 'passport_application.collection.processing_status' | translate }}</strong> 
                                <span class="badge bg-success">{{ 'passport_application.collection.completed' | translate }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>{{ 'passport_application.collection.total_paid' | translate }}</strong> {{ calculateTotalAmount() }} XAF
                            </div>
                            <div class="detail-item" *ngIf="biometricAppointment">
                                <strong>{{ 'passport_application.collection.biometric_enrollment_date' | translate }}</strong> {{ formatAppointmentDate(biometricAppointment.date) }}
                            </div>
                            <div class="detail-item">
                                <strong>{{ 'passport_application.collection.production_time' | translate }}</strong> {{ 'passport_application.collection.production_time_desc' | translate }}
                            </div>
                        </div>

                        <!-- Collection Information -->
                        <div class="collection-section mt-4">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-hand-holding me-2"></i>
                                {{ 'passport_application.collection.passport_collection' | translate }}
                            </h5>
                            <div class="collection-card">
                                <div class="collection-header">
                                    <i class="fas fa-map-marker-alt text-primary fa-2x mb-2"></i>
                                    <h6>{{ 'passport_application.collection.collection_center' | translate }}</h6>
                                </div>
                                <div class="collection-details">
                                    <p><strong>{{ getEnrollmentCenterName(biometricAppointment?.center || 'bissau-central') }}</strong></p>
                                    <p class="text-muted">{{ 'passport_application.collection.collection_desc' | translate }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info mt-4">
                            <i class="fas fa-envelope me-2"></i>
                            <strong>{{ 'passport_application.collection.email_notification' | translate }}</strong> {{ 'passport_application.collection.email_notification_desc' | translate }}
                        </div>

                        <div class="alert alert-warning mt-3">
                            <i class="fas fa-fingerprint me-2"></i>
                            <strong>{{ 'passport_application.collection.collection_verification' | translate }}</strong> {{ 'passport_application.collection.collection_verification_desc' | translate }}
                        </div>
                    </div>
                </div>

            </form>

            <!-- Navigation Buttons -->
            <div class="form-navigation mt-4">
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-outline-secondary" *ngIf="currentStep > 1 && currentStep < 6"
                        (click)="previousStep()">
                        <i class="fas fa-arrow-left me-2"></i>
                        {{ 'passport_application.buttons.previous' | translate }}
                    </button>

                    <div class="ms-auto">
                        <button type="button" class="btn btn-primary" *ngIf="currentStep < 3" (click)="nextStep()">
                            {{ 'passport_application.buttons.next' | translate }}
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>

                        <button type="button" 
                            class="btn"
                            [class.btn-success]="!shouldDisableProceedButton() && !isSubmitting"
                            [class.btn-secondary]="shouldDisableProceedButton() && !isSubmitting"
                            [class.btn-warning]="isSubmitting"
                            *ngIf="currentStep === 3"
                            [disabled]="shouldDisableProceedButton()" 
                            (click)="onSubmitApplication()">
                            
                            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
                            <i class="fas fa-credit-card me-2" *ngIf="!isSubmitting"></i>
                            
                            <span *ngIf="isSubmitting">{{ 'messages.loading' | translate }}...</span>
                            <span *ngIf="!isSubmitting">{{ 'passport_application.buttons.proceed_payment' | translate }}</span>
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 4"
                            [disabled]="!paymentVerificationComplete"
                            (click)="proceedToBiometric()">
                            {{ 'passport_application.buttons.next' | translate }}
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 5"
                            [disabled]="!biometricSubmissionComplete"
                            (click)="proceedToCollection()">
                            {{ 'passport_application.buttons.next' | translate }}
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 6"
                            (click)="goToTracking()">
                            <i class="fas fa-search me-2"></i>
                            {{ 'passport_application.buttons.track_application' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>