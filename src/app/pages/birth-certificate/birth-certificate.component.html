<div class="birth-certificate-page">
    <div class="container py-4">

        <!-- Page Header -->
        <div class="page-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="page-title">
                        <i class="fas fa-certificate me-3"></i>
                        Birth Certificate Copy
                    </h1>
                    <p class="text-muted">Request a certified copy of birth certificate</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="tracking-info" *ngIf="application">
                        <div class="tracking-display d-inline-flex align-items-center">
                            <span class="tracking-text">
                                <strong>Tracking #:</strong> {{ application.trackingNumber }}
                            </span>
                            <button class="btn btn-sm btn-outline-primary ms-2" 
                                (click)="copyTrackingNumber()" 
                                title="Copy tracking number">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-container mb-5">
            <div class="progress-steps">
                <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
                    <div class="step-circle">1</div>
                    <span class="step-label">Person Info</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 1"></div>
                <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
                    <div class="step-circle">2</div>
                    <span class="step-label">Payment</span>
                </div>
                <div class="step-line" [class.completed]="currentStep > 2"></div>
                <div class="step" [class.active]="currentStep >= 3">
                    <div class="step-circle">3</div>
                    <span class="step-label">CRVS Feedback</span>
                </div>
            </div>
        </div>

        <!-- Application Form -->
        <div class="application-form">

            <!-- Error/Success Messages -->
            <div class="alert alert-danger" *ngIf="errorMessage" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                {{ errorMessage }}
            </div>

            <div class="alert alert-success" *ngIf="successMessage" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                {{ successMessage }}
            </div>

            <form [formGroup]="certificateForm">

                <!-- Step 1: Person Information -->
                <div class="form-step" *ngIf="currentStep === 1">
                    <div class="step-header mb-4">
                        <h3>Birth Certificate Information</h3>
                        <p class="text-muted">Provide details of the person whose birth certificate is being requested</p>
                    </div>

                    <!-- Request Type -->
                    <div class="mb-4">
                        <label class="form-label">Who is this request for? *</label>
                        <div class="request-type-selection">
                            <div class="form-check form-check-card">
                                <input class="form-check-input" type="radio" value="self" formControlName="requestType"
                                    id="self" (change)="onRequestTypeChange()">
                                <label class="form-check-label" for="self">
                                    <div class="card-content">
                                        <i class="fas fa-user fa-2x mb-2"></i>
                                        <h6>For Myself</h6>
                                        <small class="text-muted">My own birth certificate</small>
                                    </div>
                                </label>
                            </div>
                            <div class="form-check form-check-card">
                                <input class="form-check-input" type="radio" value="other" formControlName="requestType"
                                    id="other" (change)="onRequestTypeChange()">
                                <label class="form-check-label" for="other">
                                    <div class="card-content">
                                        <i class="fas fa-users fa-2x mb-2"></i>
                                        <h6>For Someone Else</h6>
                                        <small class="text-muted">Child, relative, or other person</small>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Person's Information -->
                    <h5 class="mb-3">Person's Information</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">First Name *</label>
                            <input type="text" class="form-control" formControlName="personFirstName"
                                [class.is-invalid]="certificateForm.get('personFirstName')?.invalid && certificateForm.get('personFirstName')?.touched">
                            <div class="invalid-feedback">First name is required</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Middle Name</label>
                            <input type="text" class="form-control" formControlName="personMiddleName">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Last Name *</label>
                            <input type="text" class="form-control" formControlName="personLastName"
                                [class.is-invalid]="certificateForm.get('personLastName')?.invalid && certificateForm.get('personLastName')?.touched">
                            <div class="invalid-feedback">Last name is required</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" class="form-control" formControlName="personDateOfBirth"
                                [class.is-invalid]="certificateForm.get('personDateOfBirth')?.invalid && certificateForm.get('personDateOfBirth')?.touched">
                            <div class="invalid-feedback">Date of birth is required</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Place of Birth *</label>
                            <input type="text" class="form-control" formControlName="personPlaceOfBirth"
                                [class.is-invalid]="certificateForm.get('personPlaceOfBirth')?.invalid && certificateForm.get('personPlaceOfBirth')?.touched">
                            <div class="invalid-feedback">Place of birth is required</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Gender *</label>
                            <select class="form-select" formControlName="personGender"
                                [class.is-invalid]="certificateForm.get('personGender')?.invalid && certificateForm.get('personGender')?.touched">
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                            <div class="invalid-feedback">Gender is required</div>
                        </div>
                    </div>

                    <!-- Request Inputs -->
                    <h5 class="mb-3 mt-4">Request Inputs</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">User Identification Number *</label>
                            <input type="text" class="form-control" formControlName="userIdentificationNumber"
                                placeholder="Enter your ID number"
                                [class.is-invalid]="certificateForm.get('userIdentificationNumber')?.invalid && certificateForm.get('userIdentificationNumber')?.touched">
                            <div class="invalid-feedback">
                                <small *ngIf="certificateForm.get('userIdentificationNumber')?.errors?.['required']">
                                    User identification number is required
                                </small>
                                <small *ngIf="certificateForm.get('userIdentificationNumber')?.errors?.['pattern']">
                                    Please enter a valid ID number (8-12 digits)
                                </small>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Email Address *</label>
                            <input type="email" class="form-control" formControlName="emailAddress"
                                placeholder="Enter your email address"
                                [class.is-invalid]="certificateForm.get('emailAddress')?.invalid && certificateForm.get('emailAddress')?.touched">
                            <div class="invalid-feedback">
                                <small *ngIf="certificateForm.get('emailAddress')?.errors?.['required']">
                                    Email address is required
                                </small>
                                <small *ngIf="certificateForm.get('emailAddress')?.errors?.['email']">
                                    Please enter a valid email address
                                </small>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Request Reason *</label>
                            <input type="text" class="form-control" formControlName="requestReason"
                                placeholder="Enter reason for request"
                                [class.is-invalid]="certificateForm.get('requestReason')?.invalid && certificateForm.get('requestReason')?.touched">
                            <div class="invalid-feedback">Request reason is required</div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Payment -->
                <div class="form-step" *ngIf="currentStep === 2">
                    <div class="step-header mb-4">
                        <h3>Payment</h3>
                        <p class="text-muted">Complete your payment to process your certificate request</p>
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="payment-summary mb-4">
                                <h5>Payment Summary</h5>
                                <div class="fee-item">
                                    <div class="d-flex justify-content-between">
                                        <span>Birth Certificate Copy</span>
                                        <span>200 XAF</span>
                                    </div>
                                </div>
                                <hr>
                                <div class="total-amount">
                                    <div class="d-flex justify-content-between">
                                        <strong>Total Amount</strong>
                                        <strong class="text-primary">{{ calculateTotalAmount() }} XAF</strong>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Already Completed Message -->
                            <div class="alert alert-info mb-4" *ngIf="hasPaymentCompleted">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-check-circle fa-2x text-success me-3"></i>
                                    <div>
                                        <h6 class="mb-1">Payment Completed Successfully!</h6>
                                        <p class="mb-0">Your payment has been processed. Please proceed to the next step to finalize your request.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Methods with Accordions -->
                            <div class="payment-methods" *ngIf="!hasPaymentCompleted">
                                <h5 class="mb-3">Select Payment Method</h5>
                                
                                <!-- MTN Mobile Money -->
                                <div class="payment-accordion mb-3" [class.disabled]="arePaymentMethodsDisabled()">
                                    <div class="accordion-header" (click)="togglePaymentAccordion('mtn')">
                                        <div class="payment-method-option">
                                            <input type="radio" name="paymentMethod" value="mtn" 
                                                [checked]="activePaymentMethod === 'mtn'" [disabled]="arePaymentMethodsDisabled()">
                                            <i class="fas fa-mobile-alt me-3"></i>
                                            <span>MTN Mobile Money</span>
                                            <i class="fas fa-chevron-down ms-auto" 
                                                [class.rotated]="showMtnAccordion"></i>
                                        </div>
                                    </div>
                                    <div class="accordion-content" [class.show]="showMtnAccordion">
                                        <!-- MTN Payment Instructions -->
                                        <div class="payment-instructions mb-3">
                                            <h6 class="text-primary">
                                                <i class="fas fa-info-circle me-2"></i>
                                                MTN Mobile Money Payment Process
                                            </h6>
                                            <div class="instruction-steps">
                                                <div class="step-item">
                                                    <strong>Step 1:</strong> Dial <code>*126#</code> on your MTN line
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 2:</strong> Select "2" for Bill Payment
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 3:</strong> Enter the 6-digit merchant code
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 4:</strong> Enter payment amount: <strong>{{ calculateTotalAmount() }} XAF</strong>
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 5:</strong> Find the transaction ID that was sent to you by SMS and enter it in the Transaction ID field
                                                </div>
                                            </div>
                                        </div>

                                        <form [formGroup]="mtnForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">MTN Phone Number *</label>
                                                    <input type="tel" class="form-control" formControlName="phoneNumber"
                                                        placeholder="6XXXXXXXX"
                                                        [class.is-invalid]="mtnForm.get('phoneNumber')?.invalid && mtnForm.get('phoneNumber')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="mtnForm.get('phoneNumber')?.errors?.['required']">
                                                            MTN phone number is required
                                                        </small>
                                                        <small *ngIf="mtnForm.get('phoneNumber')?.errors?.['pattern']">
                                                            Please enter a valid MTN number (6XXXXXXXX)
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Merchant Code</label>
                                                    <input type="text" class="form-control" formControlName="merchantCode"
                                                        readonly>
                                                    <small class="form-text text-muted">Fixed merchant code for MK Gov services</small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Amount</label>
                                                    <input type="text" class="form-control" formControlName="amount"
                                                        readonly>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Transaction ID *</label>
                                                    <input type="text" class="form-control" formControlName="transactionId"
                                                        placeholder="e.g., 11104326398"
                                                        [class.is-invalid]="mtnForm.get('transactionId')?.invalid && mtnForm.get('transactionId')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="mtnForm.get('transactionId')?.errors?.['required']">
                                                            Transaction ID is required
                                                        </small>
                                                        <small *ngIf="mtnForm.get('transactionId')?.errors?.['pattern']">
                                                            Transaction ID must be 11 digits (e.g., 11104326398)
                                                        </small>
                                                    </div>
                                                    <small class="form-text text-muted">Enter the 11-digit transaction ID from MTN confirmation SMS</small>
                                                </div>
                                            </div>

                                            <button type="button" class="btn btn-warning" 
                                                [disabled]="isProcessingPayment || mtnForm.invalid"
                                                (click)="processMtnPayment()">
                                                <span *ngIf="isProcessingPayment && activePaymentMethod === 'mtn'" 
                                                    class="spinner-border spinner-border-sm me-2"></span>
                                                Pay Now
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Orange Money -->
                                <div class="payment-accordion mb-3" [class.disabled]="arePaymentMethodsDisabled()">
                                    <div class="accordion-header" (click)="togglePaymentAccordion('orange')">
                                        <div class="payment-method-option">
                                            <input type="radio" name="paymentMethod" value="orange" 
                                                [checked]="activePaymentMethod === 'orange'" [disabled]="arePaymentMethodsDisabled()">
                                            <i class="fas fa-mobile-alt me-3"></i>
                                            <span>Orange Money</span>
                                            <i class="fas fa-chevron-down ms-auto" 
                                                [class.rotated]="showOrangeAccordion"></i>
                                        </div>
                                    </div>
                                    <div class="accordion-content" [class.show]="showOrangeAccordion">
                                        <!-- Orange Payment Instructions -->
                                        <div class="payment-instructions mb-3">
                                            <h6 class="text-primary">
                                                <i class="fas fa-info-circle me-2"></i>
                                                Orange Money Payment Process
                                            </h6>
                                            <div class="instruction-steps">
                                                <div class="step-item">
                                                    <strong>Step 1:</strong> Dial <code>#150*47#</code> on your Orange line
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 2:</strong> Enter the merchant code when prompted
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 3:</strong> Enter payment amount: <strong>{{ calculateTotalAmount() }} XAF</strong>
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 4:</strong> Find the transaction ID that was sent to you by SMS and enter it in the Transaction ID field
                                                </div>
                                            </div>
                                        </div>

                                        <form [formGroup]="orangeForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Orange Phone Number *</label>
                                                    <input type="tel" class="form-control" formControlName="phoneNumber"
                                                        placeholder="6XXXXXXXX"
                                                        [class.is-invalid]="orangeForm.get('phoneNumber')?.invalid && orangeForm.get('phoneNumber')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="orangeForm.get('phoneNumber')?.errors?.['required']">
                                                            Orange phone number is required
                                                        </small>
                                                        <small *ngIf="orangeForm.get('phoneNumber')?.errors?.['pattern']">
                                                            Please enter a valid Orange number (6XXXXXXXX)
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Merchant Code</label>
                                                    <input type="text" class="form-control" formControlName="merchantCode"
                                                        readonly>
                                                    <small class="form-text text-muted">Fixed merchant code for MK Gov services</small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Amount</label>
                                                    <input type="text" class="form-control" formControlName="amount"
                                                        readonly>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Transaction ID *</label>
                                                    <input type="text" class="form-control" formControlName="transactionId"
                                                        placeholder="e.g., AB123456.1234.X12345"
                                                        [class.is-invalid]="orangeForm.get('transactionId')?.invalid && orangeForm.get('transactionId')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="orangeForm.get('transactionId')?.errors?.['required']">
                                                            Transaction ID is required
                                                        </small>
                                                        <small *ngIf="orangeForm.get('transactionId')?.errors?.['pattern']">
                                                            Transaction ID format: AB123456.1234.X12345
                                                        </small>
                                                    </div>
                                                    <small class="form-text text-muted">Enter the transaction ID from Orange confirmation SMS (Format: AB123456.1234.X12345)</small>
                                                </div>
                                            </div>

                                            <button type="button" class="btn btn-warning" 
                                                [disabled]="isProcessingPayment || orangeForm.invalid"
                                                (click)="processOrangePayment()">
                                                <span *ngIf="isProcessingPayment && activePaymentMethod === 'orange'" 
                                                    class="spinner-border spinner-border-sm me-2"></span>
                                                Pay Now
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Visa Credit Card -->
                                <div class="payment-accordion mb-3" [class.disabled]="arePaymentMethodsDisabled()">
                                    <div class="accordion-header" (click)="togglePaymentAccordion('visa')">
                                        <div class="payment-method-option">
                                            <input type="radio" name="paymentMethod" value="visa" 
                                                [checked]="activePaymentMethod === 'visa'" [disabled]="arePaymentMethodsDisabled()">
                                            <i class="fas fa-credit-card me-3"></i>
                                            <span>Visa Credit Card</span>
                                            <i class="fas fa-chevron-down ms-auto" 
                                                [class.rotated]="showVisaAccordion"></i>
                                        </div>
                                    </div>
                                    <div class="accordion-content" [class.show]="showVisaAccordion">
                                        <!-- Visa Payment Instructions -->
                                        <div class="payment-instructions mb-3">
                                            <h6 class="text-primary">
                                                <i class="fas fa-info-circle me-2"></i>
                                                Visa Credit Card Payment Process
                                            </h6>
                                            <div class="instruction-steps">
                                                <div class="step-item">
                                                    <strong>Step 1:</strong> Enter your Visa card details below
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 2:</strong> Verify all information is correct
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 3:</strong> Click "Pay Now" to process payment
                                                </div>
                                                <div class="step-item">
                                                    <strong>Step 4:</strong> Your payment will be processed securely through our payment gateway
                                                </div>
                                            </div>
                                        </div>

                                        <form [formGroup]="visaForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Card Number *</label>
                                                    <input type="text" class="form-control" formControlName="cardNumber"
                                                        placeholder="4*** **** **** ****"
                                                        maxlength="19"
                                                        (input)="onCardNumberInput($event)"
                                                        (keypress)="onCardNumberKeypress($event)"
                                                        [class.is-invalid]="visaForm.get('cardNumber')?.invalid && visaForm.get('cardNumber')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="visaForm.get('cardNumber')?.errors?.['required']">
                                                            Card number is required
                                                        </small>
                                                        <small *ngIf="visaForm.get('cardNumber')?.errors?.['creditCard']">
                                                            Please enter a valid 16-digit card number
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label">Expiry Date *</label>
                                                    <input type="text" class="form-control" formControlName="expiryDate"
                                                        placeholder="MM/YY"
                                                        maxlength="5"
                                                        (input)="onExpiryDateInput($event)"
                                                        (keypress)="onExpiryDateKeypress($event)"
                                                        [class.is-invalid]="visaForm.get('expiryDate')?.invalid && visaForm.get('expiryDate')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="visaForm.get('expiryDate')?.errors?.['required']">
                                                            Expiry date is required
                                                        </small>
                                                        <small *ngIf="visaForm.get('expiryDate')?.errors?.['pattern']">
                                                            Format: MM/YY
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label">CVV *</label>
                                                    <input type="text" class="form-control" formControlName="cvv"
                                                        placeholder="123"
                                                        maxlength="3"
                                                        (keypress)="onCvvKeypress($event)"
                                                        [class.is-invalid]="visaForm.get('cvv')?.invalid && visaForm.get('cvv')?.touched">
                                                    <div class="invalid-feedback">
                                                        <small *ngIf="visaForm.get('cvv')?.errors?.['required']">
                                                            CVV is required
                                                        </small>
                                                        <small *ngIf="visaForm.get('cvv')?.errors?.['pattern']">
                                                            CVV must be 3 digits
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Cardholder Name *</label>
                                                    <input type="text" class="form-control" formControlName="cardholderName"
                                                        placeholder="John Doe"
                                                        [class.is-invalid]="visaForm.get('cardholderName')?.invalid && visaForm.get('cardholderName')?.touched">
                                                    <div class="invalid-feedback">
                                                        Cardholder name is required
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Amount</label>
                                                    <input type="text" class="form-control" formControlName="amount"
                                                        readonly>
                                                </div>
                                            </div>

                                            <button type="button" class="btn btn-warning" 
                                                [disabled]="isProcessingPayment || visaForm.invalid"
                                                (click)="processVisaPayment()">
                                                <span *ngIf="isProcessingPayment && activePaymentMethod === 'visa'" 
                                                    class="spinner-border spinner-border-sm me-2"></span>
                                                Pay Now
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Status Messages -->
                            <div class="alert alert-info mt-3" *ngIf="paymentStatusPending">
                                <i class="fas fa-clock me-2"></i>
                                Payment Status: <strong>Pending</strong> - Your payment is being processed...
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="delivery-info-card">
                                <h6>Delivery Information</h6>
                                <div class="info-item">
                                    <i class="fas fa-clock text-primary me-2"></i>
                                    <strong>Expected Delivery:</strong>
                                    <br>
                                    <span class="text-muted">{{ getExpectedDeliveryTime() }}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-shield-alt text-success me-2"></i>
                                    <strong>Certified Document:</strong>
                                    <br>
                                    <span class="text-muted">Official government seal and signature</span>
                                </div>
                            </div>

                            <!-- Payment Processing Section -->
                            <div class="payment-processing-card mb-3" *ngIf="showRefreshButton">
                                <h6 class="text-primary">
                                    <i class="fas fa-credit-card me-2"></i>
                                    Payment Under Process
                                </h6>
                                <p class="text-muted mb-3">Your payment is being processed. Please wait 40 seconds before refreshing.</p>
                                <button class="btn btn-outline-primary w-100" (click)="refreshPaymentStatus()">
                                    <i class="fas fa-sync-alt me-2"></i>
                                    Refresh Status
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Confirmation -->
                <div class="form-step" *ngIf="currentStep === 3">
                    <div class="confirmation-content text-center">
                        <div class="success-icon mb-4">
                            <i class="fas fa-check-circle fa-4x text-success"></i>
                        </div>
                        <h3>Request Submitted Successfully!</h3>
                        <p class="text-muted mb-4">Your birth certificate request has been submitted and payment processed.</p>

                        <div class="confirmation-details">
                            <div class="detail-item">
                                <strong>Tracking Number:</strong>
                                <span class="text-primary">{{ application?.trackingNumber }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>Expected Completion:</strong> {{ getExpectedDeliveryTime() }}
                            </div>
                            <div class="detail-item">
                                <strong>Total Paid:</strong> {{ calculateTotalAmount() }} XAF
                            </div>
                            <div class="detail-item">
                                <strong>Document Delivery:</strong> The certified birth certificate copy has been sent to your email address
                            </div>
                        </div>

                        <div class="alert alert-info mt-4">
                            <i class="fas fa-envelope me-2"></i>
                            <strong>Email Confirmation:</strong> Your certified birth certificate copy has been sent to your registered email address. Please check your inbox and spam folder.
                        </div>
                    </div>
                </div>

            </form>

            <!-- Navigation Buttons -->
            <div class="form-navigation mt-4">
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-outline-secondary" *ngIf="currentStep > 1 && currentStep < 3"
                        (click)="previousStep()">
                        <i class="fas fa-arrow-left me-2"></i>
                        Previous
                    </button>

                    <div class="ms-auto">
                        <button type="button" class="btn btn-success" *ngIf="currentStep === 1"
                            [disabled]="isSubmitting" (click)="onSubmitApplication()">
                            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
                            Submit Request
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 2"
                            [disabled]="!paymentVerificationComplete"
                            (click)="proceedToConfirmation()">
                            Next
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>

                        <button type="button" class="btn btn-primary" *ngIf="currentStep === 3"
                            (click)="goToTracking()">
                            <i class="fas fa-search me-2"></i>
                            Track Request
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>